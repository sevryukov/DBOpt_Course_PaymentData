# Задание уровня 3
## 1. Реализация
Был реализован вариант с отложенными вычислениями, использующий дополнительную таблицу, накапливающую очередь из необработанных платежей. Затем платежи обрабатываются все разом, когда их накопилось определенное количество (например 100).

`queue/create_queue_table.sql` - запрос на создание таблицы с очередью
`queue/create_trigger.sql` - запрос на создание триггера для таблицы `Payment`

## 2. Оценка затрат
Были произведены тесты производительности двух триггеров для разных наборов данных:
|Количество строк|Количество накапливаемых записей|Триггер           |Время (мин.)|
|:--------------:|:------------------------------:|:-----------------|:----------:|
|200             |-                               |T_Payment_AI      |    0:30    |
|200             |10                              |T_Payment_AI_Queue|    0:24    |
|200             |100                             |T_Payment_AI_Queue|    0:17    |
|1000            |-                               |T_Payment_AI      |    4:19    |
|1000            |100                             |T_Payment_AI_Queue|    1:31    |

Виден рост производительности. Можно видеть, что производительность монотонно зависит от количества пропускаемых подсчетов, то есть для одного и того же количества вставляемых строк, чем больше максимальный размер очереди, тем быстрее работа, и наоборот, для одного и того же размера очереди, чем больше строк, тем больше ускорение.
## 3. Оценка недостатков
Из недостатков такого подхода можно выделить зависимость от количества транзакций в системе. Из-за этого может возникнуть ситуация, в которой количество переводов недостаточно высокое и информация о балансах предоставляется с большой задержкой, то есть является не актуальной. Эту проблему можно решить с помощью изменения максимального размера очереди, в зависимости от параметров, влияющих на загруженность системы. Также можно использовать систему при которой обновление проводится не зависимо от количества поступающих транзакций, а например просто с фиксированным промежутком времени. Либо вариант, в котором пересчет баланса ведется перед тем, как этот баланс запрашивается. Однако, у последнего подхода недостатком будет увеличение задержки при запросе на предоставление информации о балансах.
